# Multi-stage build for USB PD Specification Parser\nFROM python:3.11-slim as base\n\n# Install system dependencies\nRUN apt-get update && apt-get install -y \\\n    tesseract-ocr \\\n    tesseract-ocr-eng \\\n    poppler-utils \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Set working directory\nWORKDIR /app\n\n# Copy requirements first for better caching\nCOPY requirements.txt .\n\n# Install Python dependencies\nRUN pip install --no-cache-dir -r requirements.txt\n\n# Copy source code\nCOPY src/ ./src/\nCOPY main.py .\nCOPY application.example.yml ./application.yml\n\n# Create directories\nRUN mkdir -p assets outputs\n\n# Set environment variables\nENV PYTHONPATH=/app\nENV PYTHONUNBUFFERED=1\n\n# Create non-root user\nRUN useradd --create-home --shell /bin/bash parser\nRUN chown -R parser:parser /app\nUSER parser\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\n    CMD python -c \"import src.app; print('OK')\" || exit 1\n\n# Default command\nCMD [\"python\", \"main.py\", \"--help\"]\n\n# Production stage\nFROM base as production\n\n# Copy only necessary files\nCOPY --from=base /app /app\n\n# Set production environment\nENV ENVIRONMENT=production\n\nEXPOSE 8000\n\n# Run the application\nCMD [\"python\", \"main.py\"]